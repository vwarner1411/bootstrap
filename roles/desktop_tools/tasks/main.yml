- name: Install desktop packages on Debian
  ansible.builtin.apt:
    name:
      - kitty
      - fonts-firacode
    state: present
  when: ansible_facts.os_family == "Debian"

- name: Ensure kitty desktop entry symlink exists
  ansible.builtin.file:
    src: /opt/kitty/share/applications/kitty.desktop
    dest: /usr/share/applications/kitty.desktop
    state: link
    force: true
  when:
    - ansible_facts.os_family == "Debian"
    - (ansible_facts.get('distribution_major_version', '0') | int) >= 24

- name: Check for oh-my-zsh custom directory
  ansible.builtin.stat:
    path: "{{ ansible_env.HOME }}/.oh-my-zsh/custom"
  register: ohmyzsh_custom_dir
  become: false

- name: Install Starship completions
  ansible.builtin.shell: "starship completions zsh > {{ ansible_env.HOME }}/.oh-my-zsh/custom/starship.zsh"
  args:
    creates: "{{ ansible_env.HOME }}/.oh-my-zsh/custom/starship.zsh"
  become: false
  when: ohmyzsh_custom_dir.stat.exists
